qing.dom.ready(function(){var a=window.qVisitorInfo.loginStatus;a=="not_login"?(window.qui&&qui.showTopGuideTip&&qui.showTopGuideTip(),window._Forbid_TopYellow_Bar_=!0):(a=="not_activate"||a=="no_pass_username")&&!window.qVisitorInfo.isOldUser&&(window.qui&&qui.showTopGuideTip&&qui.showClickonceTip(),window._Forbid_TopYellow_Bar_=!0)}),qing.registNS("qdetail"),qdetail.ListenerMgr=function(){var a=function(a){return qVisitorInfo.loginStatus=="not_login"?(qing.event.stop(a),qui.showLogin(),!1):qVisitorInfo.loginStatus!="activated"?(qing.event.stop(a),qui.showActive(),!1):!0},b=function(a){var b=qext.fn.getAncestorByClass(this,"mod-repost-content"),c=qing.dom.query(".q-reasonitem",b);qing.array.each(c,function(a){qing.dom.removeClass(a,"hide")}),qing.dom.removeClass(this,"a-expand-reason"),qing.dom.addClass(this,"a-collapse-reason"),this.innerHTML="\u6536\u8d77",qing.event.stop(a)},c=function(a){var b=qext.fn.getAncestorByClass(this,"mod-repost-content"),c=qing.dom.query(".q-reasonitem",b);qing.array.each(c,function(a,b){if(b===0)return;qing.dom.addClass(a,"hide")}),qing.dom.removeClass(this,"a-collapse-reason"),qing.dom.addClass(this,"a-expand-reason"),this.innerHTML="\u67e5\u770b\u66f4\u591a\u8f6c\u8f7d\u7406\u7531",qing.event.stop(a)},d=function(a){var b=this;qui.showTip({width:140,height:20,msg:"\u786e\u5b9a\u8981\u5220\u9664\u8fd9\u7bc7\u535a\u5ba2\u5417\uff1f",target:b,anchor:"top",buttons:[{text:"\u786e\u5b9a",handler:function(a,b){qing.ajax.post("/pub/submit/deleteblog",{qbid:detailPage.threadId,bdstoken:qBdsToken},function(b){qui.showSuccess("\u5220\u9664\u6210\u529f"),a.close(),setTimeout(function(){var a=qPageInfo.referUrl;if(!a||!/^http/.test(a))a=qDomain.qing+qUserInfo.qingUrl+"/blog";location.href=a},600)},function(b){qui.showError("\u5220\u9664\u5931\u8d25"),a.close()})}},{text:"\u53d6\u6d88",type:"silver",handler:function(a,b){a.close()}}]}),qing.event.stop(a)},e=function(b){if(!a(b))return!1;var c=this,d={};d.name=detailPage.originAuthorName,d.portrait=detailPage.originPortrait;var e=qing.dom.query("#shareBnt .share-nub")[0],f=qing.dom.query("#commentBnt .comment-nub")[0],g=function(a,b,c){b.toReplyeeId&&(c.indexOf("\u56de")==0?c=c.replace("\u56de\u590d "+b.toReplyeeName+"\uff1a",""):b.toReplyeeId="");var d="";b.toReplyeeId?d=qing.string.format(qcmt.tpl.cmtReplyDetailTpl,{userUrl:qDomain.qing+"/go/check?portrait="+b.userInfo.portrait,userName:b.userInfo.nickname,replyeeUrl:b.toUrl,replyeeName:b.toReplyeeName,summary:qing.string.filterFormat.escapeString(c),isWiseIcoShowClass:"hide",imgUrl:b.userInfo.avatar||"",userId:b.userInfo.portrait||""}):d=qing.string.format(qcmt.tpl.cmtDetailTpl,{userUrl:qDomain.qing+"/go/check?portrait="+b.userInfo.portrait,userName:b.userInfo.nickname,summary:qing.string.filterFormat.escapeString(c),isWiseIcoShowClass:"hide",imgUrl:b.userInfo.avatar||"",userId:b.userInfo.portrait||""});var e="";if(a&&a[0]&&a[0].replyIdEnc)e=a[0].replyIdEnc;else return;var f=qing.string.format(qcmt.tpl.cmtItem,{userUrl:qDomain.qing+"/go/check?portrait="+b.userInfo.portrait,userId:b.userInfo.portrait,userName:b.userInfo.userName,imgUrl:b.userInfo.avatar,cmtDetailTpl:d,cmtId:e,cmtPubTime:qing.date.format(new Date(a[0].cdatetime*1e3),"yyyy-MM-dd HH:mm"),isHoverShowClass:"delete-hover-show",isReplyHideClass:"hide"}),g=qing.dom.query(".cmt-list")[0];qing.dom.insertHTML(g,"afterBegin",f)};qext.fn.scrollFix(c);var h=qing.g("shareDetail");qdetail.repostBuilder=qcmt.build(h,{type:"repost",target:c,numElem:e,extraNumElem:f,id:detailPage.threadId,actorPortrait:qUserInfo.portrait,actorName:qUserInfo.userName,actorQingUrl:qUserInfo.qingUrl,contentType:detailPage.contentType,originAuthor:d,originThreadId:detailPage.originThreadId,repostSuccess:g,count:20,max:1e8})},f=function(b){if(!a(b))return!1;qing.dom.query("#commentDetail .qcmt-textarea-box")[0].focus(),qdetail.repostBuilder&&qdetail.repostBuilder.destroy()},g=function(a){return qVisitorInfo.loginStatus=="not_login"?(qing.event.stop(a),qui.showLogin(),!1):qVisitorInfo.loginStatus!="activated"?(qing.event.stop(a),qui.showActive(),!1):!0},h=function(a){if(!g(a))return!1;var b=this;qing.ajax.post(qDomain.qing+qUserInfo.qingUrl+"/qfriend/submit/addcare",{portrait:qUserInfo.portrait,bdstoken:qBdsToken},function(a){qui.showSuccess("\u5173\u6ce8\u6210\u529f"),qing.dom.addClass(b,"a-btn-followed"),qing.dom.removeClass(b,"a-btn-follow");var c=qing.dom.query(".mod-userinfo .q-fans span")[0],d=parseInt(c.innerHTML,10)||0;c.innerHTML=d+1}),qing.event.stop(a)},i=function(a){if(!g(a))return!1;var b=this;qing.ajax.post(qDomain.qing+qUserInfo.qingUrl+"/qfriend/submit/addcare",{portrait:qUserInfo.portrait,bdstoken:qBdsToken},function(a){window.qIsNotice=!0,qui.showSuccess("\u5173\u6ce8\u6210\u529f"),qing.dom.addClass(b,"a-btn-followed"),qing.dom.addClass(b,"a-btn-followed"),qing.dom.hide(b),qing.dom.removeClass(b,"a-btn-follow"),qdetail.followPopUp&&qdetail.followPopUp.close();var c=qing.dom.query(".mod-userinfo .q-fans span");if(c&&c.length!=0){var d=c[0],e=parseInt(d.innerHTML,10)||0;d.innerHTML=e+1}}),qing.event.stop(a)},j=function(a){if(!g(a))return!1;var b=this;qing.ajax.post(qDomain.qing+qUserInfo.qingUrl+"/qfriend/submit/deletecare",{portrait:qUserInfo.portrait,bdstoken:qBdsToken},function(a){qui.showSuccess("\u53d6\u6d88\u5173\u6ce8\u6210\u529f"),qing.dom.addClass(b,"a-btn-follow"),qing.dom.removeClass(b,"a-btn-followed");var c=qing.dom.query(".mod-userinfo .q-fans span")[0],d=parseInt(c.innerHTML,10)||1;c.innerHTML=d-1}),qing.event.stop(a)},k=function(a){if(!qVisitorInfo.isHost)return;qing.dom.addClass(this,"mouseover")},l=function(a){if(!qVisitorInfo.isHost)return;qing.dom.removeClass(this,"mouseover")},m=function(){qing.q("report-btn")&&qing.q("report-btn")[0]&&qing.dom.hasClass(qing.q("report-btn")[0],"hide")&&qing.removeClass(qing.q("report-btn")[0],"hide")},n=function(){qing.q("report-btn")&&qing.q("report-btn")[0]&&!qing.dom.hasClass(qing.q("report-btn")[0],"hide")&&qing.addClass(qing.q("report-btn")[0],"hide")},o=function(a){a.close();var b,c=['<div class="mod-report-confirm">',"<p>\u60a8\u7684\u4e3e\u62a5\u5df2\u53d7\u7406\uff0c\u611f\u8c22\u60a8\u5bf9\u767e\u5ea6\u7a7a\u95f4\u7684\u652f\u6301\uff01</p>","<p>\u6211\u4eec\u7684\u5458\u5de5\u4f1a\u5c3d\u5feb\u5904\u7406\u60a8\u7684\u4e3e\u62a5</p>"].join(""),d={title:"\u4e3e\u62a5\u8fdd\u89c4\u884c\u4e3a",opacity:.2,width:410,height:90,content:c,buttons:[{text:"\u786e\u5b9a",type:"green",handler:function(){b.close()}}]};b=new qui.dialog.Dialog(d),b.show({isAutoHide:!1})},p=function(a,b){var c=qDomain.qing+"/anti/submit/report";qing.ajax.request(c,{method:"POST",data:{reporter_id:b.erId||"",reportee_id:b.eeId||"",type:b.type||"1",reason:b.reason||"1",item_id:b.itemId||"",blog_id:b.blogId||"",content:b.content||"",url:b.url||qUserInfo.qingUrl},onsuccess:a||function(){}})},q=function(){var a,b=['<div class="mod-report-article">',"<p>\u4eb2\u7231\u7684\u7528\u6237\uff1a\u6b22\u8fce\u4f7f\u7528\u767e\u5ea6\u7a7a\u95f4\u4e3e\u62a5\u7cfb\u7edf\uff0c","\u60a8\u7684\u4e3e\u62a5\u4fe1\u606f\u6211\u4eec\u5c06\u5728\u53d6\u8bc1\u540e\u5904\u7406\uff0c","\u611f\u8c22\u60a8\u7684\u652f\u6301\uff0c\u8bf7\u4e0d\u8981\u6076\u610f\u4e3e\u62a5\u54e6\uff01</p>",'<div class="report-highlight">\u4f60\u8981\u4e3e\u62a5\u7684\u662f\uff1a</div>','<div class="report-capture clearfix">','<div class="left avatar"><img src="'+qUserAvatar.size40+'"></div>','<div class="left">','<div class="uname">'+qUserInfo.nickname+"</div>",'<div class="content" >\u6587\u7ae0\u6807\u9898\uff1a'+detailPage.blogTitle+"</div>","</div>","</div>",'<p class="report-highlight">\u4e3e\u62a5\u7c7b\u578b\uff1a</p>','<form id="reportTypeForm">','<ul class="clearfix">',"<li>",'<input type="radio" name="report_type" id="report_type1" value="1" />&nbsp;','<label for="report_type1">\u5783\u573e\u5e7f\u544a</label>',"</li>","<li>",'<input type="radio" name="report_type" id="report_type2" value="2" />&nbsp;','<label for="report_type2">\u6deb\u79fd\u8272\u60c5</label>',"</li>","<li>",'<input type="radio" name="report_type" id="report_type3" value="3" />&nbsp;','<label for="report_type3">\u654f\u611f\u4fe1\u606f</label>',"</li>","<li>",'<input type="radio" name="report_type" id="report_type4" value="4" />&nbsp;','<label for="report_type4">\u4eba\u8eab\u653b\u51fb</label>',"</li>","<li>",'<input type="radio" name="report_type" id="report_type5" value="5" />&nbsp;','<label for="report_type5">\u9a9a\u6270\u4ed6\u4eba</label>',"</li>","<li>",'<input type="radio" name="report_type" id="report_type6" value="6" />&nbsp;','<label for="report_type6">\u5176\u4ed6</label>',"</li>","</ul>","</form>",'<p class="red-tip hide">\u8bf7\u9009\u62e9\u4e3e\u62a5\u7c7b\u578b~</p>',"</div>"].join(""),c={title:"\u4e3e\u62a5\u8fdd\u89c4\u884c\u4e3a",opacity:.2,width:410,height:230,content:b,buttons:[{text:"\u786e\u5b9a",type:"green",handler:function(){var b=qing.dom.query("#reportTypeForm input:checked")[0];reportReason=b?b.value:"0";var c="1";switch(detailPage.contentType){case"text":c="1";break;case"picture":c="2";break;case"video":c="3";break;case"music":c="4";break;case"repost":c="5"}reportReason!=0&&(p(function(){o(a)},{erId:qVisitorInfo.portrait,eeId:qUserInfo.portrait,type:c,reason:reportReason,itemId:detailPage.threadId,url:qUserInfo.qingUrl,content:detailPage.blogTitle}),a.close());if(reportReason==0){var d=qing.dom.query(".mod-report-article .red-tip")[0];qing.removeClass(d,"hide"),setTimeout(function(){qing.addClass(d,"hide")},5e3)}}},{text:"\u53d6\u6d88",handler:function(){a.close()}}]};a=new qui.dialog.Dialog(c),a.show({isAutoHide:!1})},r={click:{"a-sendmsg":g,"a-btn-follow":h,"a-btn-followed":j,"share-bnt":e,"comment-bnt":f,"a-expand-reason":b,"a-collapse-reason":c,"delete-bnt":d},mouseover:{"wraper-avatar":k,"mod-post-content":m},mouseout:{"wraper-avatar":l,"mod-post-content":n}},s={click:{"a-btn-follow":i}},t=function(){qext.fn.addEventMap(qing.dom.q("mod-page-main")[0],["click","mouseover","mouseout"],r),qext.fn.addEventMap(qing.dom.q("mod-topbar")[0],["click"],s)};return{run:t}}(),qing.registNS("qdetail"),qdetail.main=function(){var a=function(a,b,c){var d=new Image;d.onload=function(){var e=d.width,f=d.height;if(e&&f){var g=e/f;e>b&&(a.width=b,a.height=b/g)}c&&c()},d.src=a.src},b=function(){if(!qing.browser.ie&&qing.browser.ie>6)return;var b=qing.dom.query(".text-content img");qing.array.each(b,function(b,c){var d=qing.dom.getAncestorByClass(b,"content").clientWidth;a(b,d)})},c=function(){var a=function(a){var b=new Date(qServerInfo.timeStamp*1e3),c=new Date(a*1e3),d=Math.round(b.getTime()/1e3-a),e="",f=(new Date(c.getYear(),c.getMonth()+1,0)).getDate();return d<60?e=d+"\u79d2\u524d":d<3600?e=Math.round(d/60)+"\u5206\u949f\u524d":d<86400&&b.getDate()==c.getDate()?e=qing.date.format(c,"HH:mm"):d<172800&&(b.getDate()-c.getDate()==1||b.getDate()-c.getDate()+f==1)?e=qing.date.format(c,"\u6628\u5929HH:mm"):d<259200&&(b.getDate()-c.getDate()==2||b.getDate()-c.getDate()+f==2)?e=qing.date.format(c,"\u524d\u5929HH:mm"):e=c.getMonth()+1+"\u6708"+c.getDate()+"\u65e5",e},b=qing.dom.query(".mod-recent-readers .visit-time");qing.array.each(b,function(b,c){var d=qing.dom.getAttr(b,"data-visit-time");b.innerHTML=a(d)})},d=function(){var a=qing.dom.g("commentDetail");if(!a)return;var b=qing.dom.query("#commentDetail .comment-content")[0],c=qing.g("commentBnt"),d=qing.dom.query("#commentBnt .comment-nub")[0];if(!b)return;var e=function(){var a=qing.dom.query("#commentDetail .qcmt-textarea-box")[0],b=location.hash.replace(/^#/,""),c=40,d=qing.browser.isWebkit?document.body:document.documentElement,e=d.scrollTop;if(b=="reply"){a.focus(),qext.fn.scrollFix(a);var f=qing.dom.getPosition(a).top-c,g=f<0?0:f;d.scrollTop=g}else{var h=qing.g(b);if(h){var f=qing.dom.getPosition(h).top-c,g=f<0?0:f;d.scrollTop=g}}};qdetail.cmtBuilder=qcmt.build(b,{type:"comment",target:c,numElem:d,focus:!1,callback:e,bindTargetEvent:!1,id:detailPage.threadId,actorPortrait:qUserInfo.portrait,actorQingUrl:qUserInfo.qingUrl,count:20,max:1e10})},e=function(){var a=qing.g("content"),b=qing.dom.query(".mod-post-content .description")[0],c=[];b&&(qing.dom.query("ul",b,c),qing.dom.query("ol",b,c)),a&&(qing.dom.query("ul",a,c),qing.dom.query("ol",a,c)),qing.array.each(c,function(a,b){a.style.listStyleType&&a.style.listStyleType!="none"&&(a.style.marginLeft="35px")})},f=function(){var a=baidu.dom.query(".op-box")[0],b=baidu.dom.query(".tag-box")[0];if(b&&a){var c=a.offsetHeight;c>20&&baidu.dom.setStyles(b,{"float":"none",display:"block"})}},g=function(){if(qVisitorInfo.isHost)return;if(location.hash=="#repost"){var a=qing.dom.q("share-bnt")[0];a&&qing.event.fire(a,"click")}},h=function(){qext.back2top.init()},i=function(){if(!window.cmsBlogs||cmsBlogs.switchOn===!1)return;var a=qUserInfo.portrait;cmsBlogs.recommends[a]?j(cmsBlogs.recommends[a],"recommends"):cmsBlogs.relates[a]&&j(cmsBlogs.relates[a],"relates")},j=function(a,b){var c=qing.dom.g("relateBlog"),d=qing.dom.g("relateBlogList"),e=[];qing.dom.removeClass(c,"hide");var f=a.length;if(f<=7)e=a;else for(var g=0;g<7;g++){var h=Math.floor(Math.random()*f),i=qing.array.removeAt(a,h);e.push(i),f--}qing.array.each(e,function(a,c){var a=a||{},e=document.createElement("li");c==0&&qing.dom.addClass(e,"first"),e.innerHTML=['<a target="_blank" href="'+a.url+'" class="qing-stat-nsclick" data-nsclick="m_20121105_detail_'+b+'_img">','<img src="'+a.img+'" class="relate-img" alt="'+a.txt+'" title="'+a.txt+'" /></a>','<a class="relate-txt qing-stat-nsclick" data-nsclick="m_20121105_detail_'+b+'_txt" href="'+a.url+'">'+a.txt+"</a>"].join(""),d.appendChild(e)})},k=function(){qext.lazy.ImageLoad.init(),b(),qdetail.ListenerMgr.run(),g(),c(),d(),e(),f(),h(),T.q("report-btn")[0].href="http://tousu.baidu.com/hi.add?tsurl="+encodeURIComponent(location.href)};return{init:k}}(),qing.dom.ready(function(){qdetail.main.init()});